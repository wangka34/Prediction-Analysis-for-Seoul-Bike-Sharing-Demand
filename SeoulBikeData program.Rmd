---
title: "SeoulBikeData program"
---


```{r}
SeoulBikeData = read.csv('C:/Users/kevin/Desktop/SeoulBikeData.csv',header = TRUE)
head(SeoulBikeData)
```

```{r}
sum(is.na(SeoulBikeData))
```

```{r}
library(tidyverse)
SeoulBikeData <- SeoulBikeData %>% rename(
    rental_count = Rented.Bike.Count,
    Temperature = Temperature.癈.,
    Humidity = Humidity...,
    Wind_speed = Wind.speed..m.s.,
    Visibility_in_10m = Visibility..10m.,
    Dew_point_temperature = Dew.point.temperature.癈.,
    Solar_Radiation = Solar.Radiation..MJ.m2.,
    Rainfall_in_mm = Rainfall.mm.,
    Snowfall_in_cm = Snowfall..cm.,
    Functioning_Day = Functioning.Day
    )
head(SeoulBikeData)
str(SeoulBikeData)
```

```{r}
ggplot(SeoulBikeData, aes(x=rental_count)) + geom_histogram(color="blue", fill="white")
```


```{r}
nrow(subset(SeoulBikeData, rental_count==0))
SeoulBikeData %>% count(Functioning_Day)
SeoulBikeData$Functioning_Day[SeoulBikeData$Functioning_Day == 'No'] <- 0
SeoulBikeData$Functioning_Day[SeoulBikeData$Functioning_Day == 'Yes'] <- 1
SeoulBikeData$Functioning_Day <- as.numeric(SeoulBikeData$Functioning_Day)
ggplot(SeoulBikeData, aes(x=rental_count, y=Functioning_Day)) +
  geom_point() +
  geom_smooth(method = "glm", 
    method.args = list(family = "binomial"), 
    se = FALSE)
SeoulBikeData_nonFunction <- filter(SeoulBikeData, Functioning_Day == 0)
SeoulBikeData_nonFunction %>% count(rental_count)
SeoulBikeData_nonFunction %>% count(Functioning_Day)
```

```{r}
SeoulBikeData_Function <- filter(SeoulBikeData, Functioning_Day == 1)
str(SeoulBikeData_Function)
ggplot(SeoulBikeData_Function, aes(x=rental_count)) + geom_histogram(aes(y=..density..),color="blue", fill="white") + geom_density()
```

```{r}
ggplot(SeoulBikeData_Function, aes(y=rental_count)) + 
  geom_boxplot()
```


```{r}
summary(SeoulBikeData_Function$rental_count)
```

```{r}
summary(SeoulBikeData_Function$Temperature)
```
```{r}
summary(SeoulBikeData_Function$Humidity)
```
```{r}
summary(SeoulBikeData_Function$Wind_speed)
```
```{r}
summary(SeoulBikeData_Function$Visibility_in_10m)
```
```{r}
summary(SeoulBikeData_Function$Dew_point_temperature)
```
```{r}
summary(SeoulBikeData_Function$Solar_Radiation)
```
```{r}
summary(SeoulBikeData_Function$Rainfall_in_mm)
```
```{r}
summary(SeoulBikeData_Function$Snowfall_in_cm)
```

```{r}
ggplot(SeoulBikeData_Function, aes(x=Seasons , y=rental_count, fill=Seasons)) + 
  geom_boxplot()
```
```{r}
ggplot(SeoulBikeData_Function, aes(x=Holiday , y=rental_count, fill=Holiday)) + 
  geom_boxplot()
```

```{r}
count_vs_hour <- SeoulBikeData_Function[2:3]
count_vs_hour$Hour <- as.character(count_vs_hour$Hour)
str(count_vs_hour)
ggplot(count_vs_hour,aes(x=Hour , y=rental_count,fill = Hour)) + geom_boxplot()
```


```{r}
SeoulBikeData_Function$Seasons[SeoulBikeData_Function$Seasons == 'Winter'] <- 1
SeoulBikeData_Function$Seasons[SeoulBikeData_Function$Seasons == 'Spring'] <- 2
SeoulBikeData_Function$Seasons[SeoulBikeData_Function$Seasons == 'Summer'] <- 3
SeoulBikeData_Function$Seasons[SeoulBikeData_Function$Seasons == 'Autumn'] <- 4
SeoulBikeData_Function$Seasons <- as.numeric(SeoulBikeData_Function$Seasons)
SeoulBikeData_Function %>% count(Seasons)
```

```{r}
SeoulBikeData_Function %>% count(Holiday)
SeoulBikeData_Function$Holiday[SeoulBikeData_Function$Holiday == 'Holiday'] <- 1
SeoulBikeData_Function$Holiday[SeoulBikeData_Function$Holiday == 'No Holiday'] <- 2
SeoulBikeData_Function$Holiday <- as.numeric(SeoulBikeData_Function$Holiday)
SeoulBikeData_Function %>% count(Holiday)
```


```{r}
correlation_test <- SeoulBikeData_Function[2:11]
str(correlation_test)
cor(correlation_test)
```

```{r}
plot(correlation_test)
```
```{r}
library(reshape2)
melted<- melt(round(cor(correlation_test),2))
library(ggplot2)
ggplot(data = melted, aes(x=Var1, y=Var2, fill=value)) + geom_tile() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, size = 12, hjust = 1))+ coord_fixed()
```


```{r}
ggplot(correlation_test, aes(x=Temperature, y=Dew_point_temperature)) + 
  geom_point()+
  geom_smooth(method=lm, se=FALSE)
test_model_1 <- lm(Temperature~Dew_point_temperature,data = correlation_test)
summary(test_model_1)
```

```{r}
SeoulBikeData_Function_mlr <- SeoulBikeData_Function[c(2:7,9:13)]
head(SeoulBikeData_Function_mlr)
```


```{r}
library(MASS)
library(leaps)
```

```{r}
library(caret)
train_control <- trainControl(method = "cv", number = 10,p = 0.75)
```


```{r}
set.seed(903)
model_mlr <- train(rental_count~., data=SeoulBikeData_Function_mlr,method = "lm", trControl = train_control,metric = "RMSE")
model_mlr
summary(model_mlr)
```


```{r}
set.seed(903)
step_model <- train(rental_count~., data = SeoulBikeData_Function_mlr,
                    method = "lmStepAIC", 
                    trControl = train_control,
                    trace = FALSE)
step_model
summary(step_model)
```
```{r}
subsets<-regsubsets(rental_count~.,
data=SeoulBikeData_Function_mlr, nbest=1)
sub.sum <- summary(subsets)
as.data.frame(sub.sum$outmat)
```

```{r}
library(rpart)
library(rpart.plot)
```



```{r}
set.seed(903)
dt_model <- train(rental_count ~ .,
   tuneLength = 10,metric = "RMSE", data = SeoulBikeData_Function_mlr, method = "rpart",trControl =train_control)
print(dt_model)
```

```{r}
plot(dt_model)
```
```{r}
dt_model$finalModel
rpart.plot(dt_model$finalModel)
```



```{r}
set.seed(903)
model_knn <- train(
   rental_count~., data = SeoulBikeData_Function_mlr, method = "knn",
  trControl = train_control,
  preProcess = c("center","scale"),
  tuneLength = 10)
plot(model_knn)
model_knn
model_knn$bestTune
```



